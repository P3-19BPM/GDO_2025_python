<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro PMMG</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }

        .header-miv {
            background-color: #a18c5e;
            color: white;
            padding: 20px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .form-wrapper {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 576px) {
            .header-miv h4 {
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>

    <div class="container mt-3">
        <div class="header-miv text-center">
            <h4 class="fw-bold">
                MILITARES VOLUNTÁRIOS PARA TREINAMENTO E UTILIZAÇÃO DE APLICATIVO PARA AUTUAÇÃO DE TRÂNSITO
            </h4>
        </div>

        <form id="formPMMG" class="form-wrapper">

            <div class="mb-3">
                <label for="pg" class="form-label">Posto / Graduação (P/G)</label>
                <select class="form-select" id="pg" required>
                    <option value="">Selecione</option>
                    <option>Cel</option>
                    <option>Ten Cel</option>
                    <option>Maj</option>
                    <option>Cap</option>
                    <option>1º Ten</option>
                    <option>2º Ten</option>
                    <option>Sub Ten</option>
                    <option>1º Sgt</option>
                    <option>2º Sgt</option>
                    <option>3º Sgt</option>
                    <option>Cb</option>
                    <option>SD</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="nome" class="form-label">Nome</label>
                <input type="text" class="form-control" id="nome" required />
            </div>

            <div class="mb-3">
                <label for="nrPolicia" class="form-label">Nr Polícia</label>
                <input type="text" class="form-control" id="nrPolicia" maxlength="10" required />
            </div>

            <div class="mb-3">
                <label for="cpf" class="form-label">CPF</label>
                <input type="text" class="form-control" id="cpf" maxlength="14" required />
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="email" required readonly />
            </div>

            <div class="mb-3">
                <label for="unidade" class="form-label">Unidade</label>
                <select class="form-select" id="unidade" required>
                    <option value="">Selecione</option>
                    <option>19º BPM</option>
                    <option>44ª BPM</option>
                    <option>70º BPM</option>
                    <option>24ª Cia IND</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="celular" class="form-label">Celular</label>
                <input type="text" class="form-control" id="celular" maxlength="15" required />
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-dark">Salvar</button>
            </div>
        </form>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCJngFp_kl4Sp-eVv4UjYlPX52Vz6n6nUE",
            authDomain: "autua-19bpm.firebaseapp.com",
            projectId: "autua-19bpm",
            storageBucket: "autua-19bpm.firebasestorage.app",
            messagingSenderId: "970967291366",
            appId: "1:970967291366:web:a370cdf73e0f60b1e9b227",
            measurementId: "G-RFD0K7KNSJ"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById("email").value = user.email;
            } else {
                firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider());
            }
        });

        document.getElementById("formPMMG").addEventListener("submit", async (e) => {
            e.preventDefault();
            const data = {
                pg: pg.value,
                nome: nome.value,
                nrPolicia: nrPolicia.value,
                cpf: cpf.value,
                email: email.value,
                unidade: unidade.value,
                celular: celular.value
            };
            try {
                await db.collection("cadastros_pmmg").add(data);
                alert("Cadastro salvo com sucesso!");
                document.getElementById("formPMMG").reset();
            } catch (err) {
                alert("Erro ao salvar: " + err.message);
            }
        });

        nrPolicia.addEventListener("input", function () {
            let v = this.value.replace(/\D/g, "").slice(0, 7);
            if (v.length > 6) this.value = `${v.slice(0, 3)}.${v.slice(3, 6)}-${v.slice(6)}`;
            else if (v.length > 3) this.value = `${v.slice(0, 3)}.${v.slice(3)}`;
            else this.value = v;
        });

        cpf.addEventListener("input", function () {
            let v = this.value.replace(/\D/g, "").slice(0, 11);
            if (v.length > 9) this.value = v.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
            else if (v.length > 6) this.value = v.replace(/(\d{3})(\d{3})(\d{0,3})/, "$1.$2.$3");
            else if (v.length > 3) this.value = v.replace(/(\d{3})(\d{0,3})/, "$1.$2");
            else this.value = v;
        });

        celular.addEventListener("input", function () {
            let v = this.value.replace(/\D/g, "").slice(0, 11);
            if (v.length > 6) this.value = v.replace(/(\d{2})(\d{5})(\d{0,4})/, "($1) $2-$3");
            else if (v.length > 2) this.value = v.replace(/(\d{2})(\d{0,5})/, "($1) $2");
            else this.value = v;
        });
    </script>
</body>

</html>